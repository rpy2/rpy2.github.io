

<!doctype html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Using rpy2 in notebooks &#8212; rpy2 3.4.5 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/bizstyle.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="R and pandas data frames" href="pandas.html" />
    <link rel="prev" title="Introduction to rpy2" href="../introduction.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <!--[if lt IE 9]>
    <script src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="pandas.html" title="R and pandas data frames"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../introduction.html" title="Introduction to rpy2"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">rpy2 3.4.5 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../getting-started.html" accesskey="U">Getting started</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Using rpy2 in notebooks</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="using-rpy2-in-notebooks">
<h1>Using rpy2 in notebooks<a class="headerlink" href="#using-rpy2-in-notebooks" title="Permalink to this headline">¶</a></h1>
<p><cite>rpy2</cite> is designed to play well with notebooks. While the target
notebook is jupyter, it is used in other notebook systems (some of
them are based on <a class="reference external" href="https://jupyter.org/">Jupyter</a>, or are managed Jupyter notebook systems).</p>
<p>rpy2 is working, and is sometimes available by default, with
<a class="reference external" href="https://research.google.com/colaboratory/faq.html">Google’s Colab</a>,
<a class="reference external" href="https://docs.databricks.com/notebooks/index.html">Databricks notebooks</a>, <a class="reference external" href="https://docs.aws.amazon.com/sagemaker/latest/dg/nbi.html">AWS SageMaker</a>, <a class="reference external" href="https://notebooks.azure.com/">Azure Notebooks</a>,
or <a class="reference external" href="https://cloud.google.com/ai-platform-notebooks">Google Cloud AI Platform Notebooks</a>.</p>
<p>This section shows how <cite>rpy2</cite> can be used to add everything R can offer
to Python notebooks.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This section is available as a jupyter notebook <a class="reference external" href="_static/notebooks/jupyter.ipynb">jupyter.ipynb</a> (HTML render: <a class="reference external" href="_static/notebooks/jupyter.html">jupyter.html</a>)</p>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">rpy2.ipython</span> <span class="kn">import</span> <span class="n">html</span>
<span class="n">html</span><span class="o">.</span><span class="n">html_rdataframe</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="n">html</span><span class="o">.</span><span class="n">html_rdataframe</span><span class="p">,</span> <span class="n">table_class</span><span class="o">=</span><span class="s2">&quot;docutils&quot;</span><span class="p">)</span>
</pre></div>
</div>
<section id="data-import">
<h2>Data Import<a class="headerlink" href="#data-import" title="Permalink to this headline">¶</a></h2>
<p>We choose to use an external dataset to demonstrate how R’s own data
import features can be used.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rpy2.robjects.packages</span> <span class="kn">import</span> <span class="n">importr</span>
<span class="n">utils</span> <span class="o">=</span> <span class="n">importr</span><span class="p">(</span><span class="s1">&#39;utils&#39;</span><span class="p">)</span>

<span class="n">dataf</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/jakevdp/PythonDataScienceHandbook/&#39;</span>
                       <span class="s1">&#39;master/notebooks/data/california_cities.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The objects returned by R’s own <code class="docutils literal notranslate"><span class="pre">read.csv()</span></code> function (note that the R
function in the R package <code class="docutils literal notranslate"><span class="pre">utils</span></code> is called <code class="docutils literal notranslate"><span class="pre">read.csv()</span></code> while the
Python function is called <code class="docutils literal notranslate"><span class="pre">read_csv()</span></code> - <code class="docutils literal notranslate"><span class="pre">rpy2</span></code> converts R symbols
with dots to underscores for Python).</p>
<p><code class="docutils literal notranslate"><span class="pre">rpy2</span></code> provides customization to display R objects such as data frames
in HTML in a notebook. That customization is enabled as follows:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">rpy2.ipython.html</span>
<span class="n">rpy2</span><span class="o">.</span><span class="n">ipython</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">init_printing</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataf</span>
</pre></div>
</div>
<emph>DataFrame</emph> with 482 rows and
  14 columns:
<table class="docutils">
  <thead>
    <tr class="rpy2_names">
      <th></th>
      <th></th>
      <th>X</th>
      <th>city</th>
      <th>latd</th>
      <th>longd</th>
      <th>...</th>
      <th>area_water_km2</th>
      <th>area_water_percent</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td class="rpy2_rowname">0</td>
        <td class="rpy2_names">1</td>
      <td>0</td>
      <td>Adelanto</td>
      <td>34.57611111111112</td>
      <td>-117.43277777777779</td>
       <td>...</td>
      <td>0.046</td>
      <td>0.03</td>
    </tr>
    <tr>
      <td class="rpy2_rowname">1</td>
        <td class="rpy2_names">2</td>
      <td>1</td>
      <td>AgouraHills</td>
      <td>34.15333333333333</td>
      <td>-118.76166666666667</td>
       <td>...</td>
      <td>0.076</td>
      <td>0.37</td>
    </tr>
    <tr>
      <td class="rpy2_rowname">2</td>
        <td class="rpy2_names">3</td>
      <td>2</td>
      <td>Alameda</td>
      <td>37.75611111111111</td>
      <td>-122.27444444444444</td>
       <td>...</td>
      <td>31.983</td>
      <td>53.79</td>
    </tr>
    <tr>
      <td class="rpy2_rowname">3</td>
        <td class="rpy2_names">4</td>
      <td>3</td>
      <td>Albany</td>
      <td>37.886944444444445</td>
      <td>-122.29777777777778</td>
       <td>...</td>
      <td>9.524</td>
      <td>67.28</td>
    </tr>
    <tr>
      <td class="rpy2_rowname">4</td>
        <td class="rpy2_names">5</td>
      <td>4</td>
      <td>Alhambra</td>
      <td>34.081944444444446</td>
      <td>-118.135</td>
       <td>...</td>
      <td>0.003</td>
      <td>0.01</td>
    </tr>
    <tr>
      <td class="rpy2_rowname">5</td>
        <td class="rpy2_names">6</td>
      <td>5</td>
      <td>AlisoViejo</td>
      <td>33.575</td>
      <td>-117.72555555555556</td>
       <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <td class="rpy2_rowname">6</td>
        <td class="rpy2_names">7</td>
      <td>6</td>
      <td>Alturas</td>
      <td>41.48722222222222</td>
      <td>-120.5425</td>
       <td>...</td>
      <td>0.036000000000000004</td>
      <td>0.57</td>
    </tr>
    <tr>
      <td class="rpy2_rowname">7</td>
        <td class="rpy2_names">8</td>
      <td>7</td>
      <td>AmadorCity</td>
      <td>38.419444444444444</td>
      <td>-120.82416666666666</td>
       <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <td class="rpy2_rowname">...</td>
        <td class="rpy2_names">...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
       <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <td class="rpy2_rowname">480</td>
        <td class="rpy2_names">481</td>
      <td>480</td>
      <td>Yucaipa</td>
      <td>34.030277777777776</td>
      <td>-117.04861111111111</td>
       <td>...</td>
      <td>0.013000000000000001</td>
      <td>0.02</td>
    </tr>
    <tr>
      <td class="rpy2_rowname">481</td>
        <td class="rpy2_names">482</td>
      <td>481</td>
      <td>YuccaValley</td>
      <td>34.13333333333333</td>
      <td>-116.41666666666667</td>
       <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table><div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataf</span><span class="o">.</span><span class="n">colnames</span>
</pre></div>
</div>
<emph>StrVector</emph> with 14 elements:
<table class="rpy2_table">
<thead>
</thead>
<tbody>
<tr>
  <td>X</td>
  <td>city</td>
  <td>latd</td>
  <td>longd</td>
  <td>elevation_m</td>
  <td>elevation_ft</td>
  <td>population_total</td>
  <td>area_total_sq_mi</td>
  <td>...</td>
      <td>area_water_km2</td>
      <td>area_water_percent</td>
</tr>
</tbody>
</table><div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stats</span> <span class="o">=</span> <span class="n">importr</span><span class="p">(</span><span class="s1">&#39;stats&#39;</span><span class="p">)</span>
<span class="n">base</span> <span class="o">=</span> <span class="n">importr</span><span class="p">(</span><span class="s1">&#39;base&#39;</span><span class="p">)</span>
<span class="n">fit</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">lm</span><span class="p">(</span><span class="s1">&#39;elevation_m ~ latd + longd&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">dataf</span><span class="p">)</span>
<span class="n">fit</span>
</pre></div>
</div>
<emph>ListVector</emph> with 13 elements:
<table class="rpy2_table">
<thead>
</thead>
<tbody>
  <tr>
    <td class="rpy2_rowname">0</td>
    <td class="rpy2_names">coefficients</td>
    <td>(Intercep...</td>
  </tr>
  <tr>
    <td class="rpy2_rowname">1</td>
    <td class="rpy2_names">residuals</td>
    <td>        ...</td>
  </tr>
  <tr>
    <td class="rpy2_rowname">2</td>
    <td class="rpy2_names">effects</td>
    <td> ...</td>
  </tr>
  <tr>
    <td class="rpy2_rowname">3</td>
    <td class="rpy2_names">rank</td>
    <td>[1] 3
</td>
  </tr>
  <tr>
    <td class="rpy2_rowname">4</td>
    <td class="rpy2_names">fitted.values</td>
    <td>        ...</td>
  </tr>
  <tr>
    <td class="rpy2_rowname">5</td>
    <td class="rpy2_names">assign</td>
    <td>[1] 0 1 2
</td>
  </tr>
  <tr>
    <td class="rpy2_rowname">6</td>
    <td class="rpy2_names">qr</td>
    <td>$qr
    ...</td>
  </tr>
  <tr>
    <td class="rpy2_rowname">7</td>
    <td class="rpy2_names">df.residual</td>
    <td>[1] 431
</td>
  </tr>
  <tr>
    <td class="rpy2_rowname">...</td>
    <td class="rpy2_names">...</td>
    <td>...</td>
  </tr>
  <tr>
    <td class="rpy2_rowname">11</td>
    <td class="rpy2_names">terms</td>
    <td>elevation...</td>
  </tr>
  <tr>
    <td class="rpy2_rowname">12</td>
    <td class="rpy2_names">model</td>
    <td>   ...</td>
  </tr>
</tr>
</tbody>
</table></section>
<section id="graphics">
<h2>Graphics<a class="headerlink" href="#graphics" title="Permalink to this headline">¶</a></h2>
<p>R has arguably some the best static visualizations, often looking more
polished than other visualization systems and this without the need to
spend much effort on them.</p>
<section id="using-ggplot2">
<h3>Using <code class="docutils literal notranslate"><span class="pre">ggplot2</span></code><a class="headerlink" href="#using-ggplot2" title="Permalink to this headline">¶</a></h3>
<p>Among R visulization pacakges, <code class="docutils literal notranslate"><span class="pre">ggplot2</span></code> has emerged as something
Python users wished so much they had that various projects to try port
it to Python are regularly started.</p>
<p>However, the best way to have <code class="docutils literal notranslate"><span class="pre">ggplot2</span></code> might be to use <code class="docutils literal notranslate"><span class="pre">ggplot2</span></code>
from Python.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">rpy2.robjects.lib.ggplot2</span> <span class="k">as</span> <span class="nn">gp</span>
</pre></div>
</div>
<p>R lets is function parameters be unevaluated language objects, which is
fairly different from Python’s immediate evaluation. <code class="docutils literal notranslate"><span class="pre">rpy2</span></code> has a
utility code to create such R language objects from Python strings. It
can then become very easy to mix Python and R, with R like a
domain-specific language used from Python.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rpy2.robjects</span> <span class="kn">import</span> <span class="n">rl</span>
</pre></div>
</div>
<p>Calling <code class="docutils literal notranslate"><span class="pre">ggplot2</span></code> looks pretty much like it would in R, which allows
one to use the all available documentation and examples available for
the R package. Remember that this is not a reimplementation of ggplot2
with inevitable differences and delay for having the latest changes: the
R package itself is generating the figures.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">ggplot</span><span class="p">(</span><span class="n">dataf</span><span class="p">)</span> <span class="o">+</span>
     <span class="n">gp</span><span class="o">.</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">rl</span><span class="p">(</span><span class="s1">&#39;longd&#39;</span><span class="p">),</span>
            <span class="n">y</span><span class="o">=</span><span class="n">rl</span><span class="p">(</span><span class="s1">&#39;latd&#39;</span><span class="p">),</span>
            <span class="n">color</span><span class="o">=</span><span class="n">rl</span><span class="p">(</span><span class="s1">&#39;population_total&#39;</span><span class="p">),</span>
            <span class="n">size</span><span class="o">=</span><span class="n">rl</span><span class="p">(</span><span class="s1">&#39;area_total_km2&#39;</span><span class="p">))</span> <span class="o">+</span>
     <span class="n">gp</span><span class="o">.</span><span class="n">geom_point</span><span class="p">()</span> <span class="o">+</span>
     <span class="n">gp</span><span class="o">.</span><span class="n">scale_color_continuous</span><span class="p">(</span><span class="n">trans</span><span class="o">=</span><span class="s1">&#39;log10&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>Plotting the resulting R/ggplot2 object into the output cell of a
notebook, is just function call away.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rpy2.ipython.ggplot</span> <span class="kn">import</span> <span class="n">image_png</span>
<span class="n">image_png</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/jupyter_15_0.png" src="../_images/jupyter_15_0.png" />
<p>All features from <code class="docutils literal notranslate"><span class="pre">ggplot2</span></code> should be present. A more complex example
to get the figure we want is:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rpy2.robjects.vectors</span> <span class="kn">import</span> <span class="n">IntVector</span>
<span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">ggplot</span><span class="p">(</span><span class="n">dataf</span><span class="p">)</span> <span class="o">+</span>
     <span class="n">gp</span><span class="o">.</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">rl</span><span class="p">(</span><span class="s1">&#39;longd&#39;</span><span class="p">),</span>
            <span class="n">y</span><span class="o">=</span><span class="n">rl</span><span class="p">(</span><span class="s1">&#39;latd&#39;</span><span class="p">),</span>
            <span class="n">color</span><span class="o">=</span><span class="n">rl</span><span class="p">(</span><span class="s1">&#39;population_total&#39;</span><span class="p">),</span>
            <span class="n">size</span><span class="o">=</span><span class="n">rl</span><span class="p">(</span><span class="s1">&#39;area_total_km2&#39;</span><span class="p">))</span> <span class="o">+</span>
     <span class="n">gp</span><span class="o">.</span><span class="n">geom_point</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span> <span class="o">+</span>
     <span class="c1"># Axis definitions.</span>
     <span class="n">gp</span><span class="o">.</span><span class="n">scale_x_continuous</span><span class="p">(</span><span class="s1">&#39;Longitude&#39;</span><span class="p">)</span> <span class="o">+</span>
     <span class="n">gp</span><span class="o">.</span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="s1">&#39;Latitude&#39;</span><span class="p">)</span> <span class="o">+</span>
     <span class="c1"># Custom size range.</span>
     <span class="n">gp</span><span class="o">.</span><span class="n">scale_size</span><span class="p">(</span><span class="nb">range</span><span class="o">=</span><span class="n">IntVector</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">18</span><span class="p">]))</span> <span class="o">+</span>
     <span class="c1"># Transform for pop -&gt; color mapping</span>
     <span class="n">gp</span><span class="o">.</span><span class="n">scale_color_continuous</span><span class="p">(</span><span class="n">trans</span><span class="o">=</span><span class="s1">&#39;log10&#39;</span><span class="p">)</span> <span class="o">+</span>
     <span class="c1"># Title.</span>
     <span class="n">gp</span><span class="o">.</span><span class="n">ggtitle</span><span class="p">(</span><span class="s1">&#39;California Cities: Area and Population&#39;</span><span class="p">)</span> <span class="o">+</span>
     <span class="c1"># Plot theme and text size.</span>
     <span class="n">gp</span><span class="o">.</span><span class="n">theme_light</span><span class="p">(</span><span class="n">base_size</span><span class="o">=</span><span class="mi">16</span><span class="p">))</span>
<span class="n">image_png</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/jupyter_17_0.png" src="../_images/jupyter_17_0.png" />
</section>
<section id="using-ggplot2-extensions">
<h3>Using <code class="docutils literal notranslate"><span class="pre">ggplot2</span></code> extensions<a class="headerlink" href="#using-ggplot2-extensions" title="Permalink to this headline">¶</a></h3>
<p>There existing additional R packages extending <code class="docutils literal notranslate"><span class="pre">ggplot2</span></code>, and while it
would be impossible for the rpy2 to provide wrapper for all of them the
wrapper for <code class="docutils literal notranslate"><span class="pre">ggplot2</span></code> is based on class hierarchies that should make
the use of such extensions really easy.</p>
<p>For example, to use the viridis color scale, we just need to import the
corresponding R package, and write 3 lines of Python to extend
<code class="docutils literal notranslate"><span class="pre">rpy2</span></code>’s ggplot2 wrapper with a new color scale. A clas diagram with
the classes in the rpy2 wrapper for ggplot2 is available in the rpy2
documentation.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">viridis</span> <span class="o">=</span> <span class="n">importr</span><span class="p">(</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">ScaleColorViridis</span><span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">ScaleColour</span><span class="p">):</span>
    <span class="n">_constructor</span> <span class="o">=</span> <span class="n">viridis</span><span class="o">.</span><span class="n">scale_color_viridis</span>
<span class="n">scale_color_viridis</span> <span class="o">=</span> <span class="n">ScaleColorViridis</span><span class="o">.</span><span class="n">new</span>
</pre></div>
</div>
<p>That new color scale can then be used as any other scale already present
in <code class="docutils literal notranslate"><span class="pre">ggplot2</span></code>:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">ggplot</span><span class="p">(</span><span class="n">dataf</span><span class="p">)</span> <span class="o">+</span>
     <span class="n">gp</span><span class="o">.</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">rl</span><span class="p">(</span><span class="s1">&#39;longd&#39;</span><span class="p">),</span>
            <span class="n">y</span><span class="o">=</span><span class="n">rl</span><span class="p">(</span><span class="s1">&#39;latd&#39;</span><span class="p">),</span>
            <span class="n">color</span><span class="o">=</span><span class="n">rl</span><span class="p">(</span><span class="s1">&#39;population_total&#39;</span><span class="p">),</span>
            <span class="n">size</span><span class="o">=</span><span class="n">rl</span><span class="p">(</span><span class="s1">&#39;area_total_km2&#39;</span><span class="p">))</span> <span class="o">+</span>
     <span class="n">gp</span><span class="o">.</span><span class="n">geom_point</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span> <span class="o">+</span>
     <span class="n">gp</span><span class="o">.</span><span class="n">scale_x_continuous</span><span class="p">(</span><span class="s1">&#39;Longitude&#39;</span><span class="p">)</span> <span class="o">+</span>
     <span class="n">gp</span><span class="o">.</span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="s1">&#39;Latitude&#39;</span><span class="p">)</span> <span class="o">+</span>
     <span class="n">gp</span><span class="o">.</span><span class="n">scale_size</span><span class="p">(</span><span class="nb">range</span><span class="o">=</span><span class="n">IntVector</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">18</span><span class="p">]))</span> <span class="o">+</span>
     <span class="n">scale_color_viridis</span><span class="p">(</span><span class="n">trans</span><span class="o">=</span><span class="s1">&#39;log10&#39;</span><span class="p">)</span> <span class="o">+</span>
     <span class="n">gp</span><span class="o">.</span><span class="n">ggtitle</span><span class="p">(</span><span class="s1">&#39;California Cities: Area and Population&#39;</span><span class="p">)</span> <span class="o">+</span>
     <span class="n">gp</span><span class="o">.</span><span class="n">theme_light</span><span class="p">(</span><span class="n">base_size</span><span class="o">=</span><span class="mi">16</span><span class="p">))</span>
<span class="n">image_png</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/jupyter_21_0.png" src="../_images/jupyter_21_0.png" />
<p>So far we have shown that using <code class="docutils literal notranslate"><span class="pre">ggplot2</span></code> can be done from Python as
if it was just an other Python library for visualization, but R can also
be used in cells.</p>
<p>First the so-called “R magic” extension should be loaded.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> rpy2.ipython
</pre></div>
</div>
<p>From now on, code cells starting with <code class="docutils literal notranslate"><span class="pre">%%R</span></code> will see their content
evaluated as R code. If the R code is generating figures, they will be
displayed along with the rest of the output.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">R</span>
<span class="n">R.version.string</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="s2">&quot;R version 4.0.5 (2021-03-31)&quot;</span>
</pre></div>
</div>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">R</span> <span class="o">-</span><span class="n">i</span> <span class="n">dataf</span>

<span class="nf">require</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span>
<span class="nf">glimpse</span><span class="p">(</span><span class="n">dataf</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>R[write to console]: Loading required package: dplyr

R[write to console]:
Attaching package: ‘dplyr’


R[write to console]: The following objects are masked from ‘package:stats’:

    filter, lag


R[write to console]: The following objects are masked from ‘package:base’:

    intersect, setdiff, setequal, union
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Rows: 482
Columns: 14
$ X                  &lt;int&gt; 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 1…
$ city               &lt;chr&gt; &quot;Adelanto&quot;, &quot;AgouraHills&quot;, &quot;Alameda&quot;, &quot;Albany&quot;, &quot;Al…
$ latd               &lt;dbl&gt; 34.57611, 34.15333, 37.75611, 37.88694, 34.08194, 3…
$ longd              &lt;dbl&gt; -117.4328, -118.7617, -122.2744, -122.2978, -118.13…
$ elevation_m        &lt;dbl&gt; 875, 281, NA, NA, 150, 127, 1332, 280, 14, 48, 132,…
$ elevation_ft       &lt;dbl&gt; 2871, 922, 33, 43, 492, 417, 4370, 919, 46, 157, 43…
$ population_total   &lt;int&gt; 31765, 20330, 75467, 18969, 83089, 47823, 2827, 185…
$ area_total_sq_mi   &lt;dbl&gt; 56.027, 7.822, 22.960, 5.465, 7.632, 7.472, 2.449, …
$ area_land_sq_mi    &lt;dbl&gt; 56.009, 7.793, 10.611, 1.788, 7.631, 7.472, 2.435, …
$ area_water_sq_mi   &lt;dbl&gt; 0.018, 0.029, 12.349, 3.677, 0.001, 0.000, 0.014, 0…
$ area_total_km2     &lt;dbl&gt; 145.107, 20.260, 59.465, 14.155, 19.766, 19.352, 6.…
$ area_land_km2      &lt;dbl&gt; 145.062, 20.184, 27.482, 4.632, 19.763, 19.352, 6.3…
$ area_water_km2     &lt;dbl&gt; 0.046, 0.076, 31.983, 9.524, 0.003, 0.000, 0.036, 0…
$ area_water_percent &lt;dbl&gt; 0.03, 0.37, 53.79, 67.28, 0.01, 0.00, 0.57, 0.00, 0…
</pre></div>
</div>
<p>The data frame called <code class="docutils literal notranslate"><span class="pre">dataf</span></code> in our Python notebook was already bound
to the name <code class="docutils literal notranslate"><span class="pre">dataf</span></code> in the R main namespace (<code class="docutils literal notranslate"><span class="pre">GlobalEnv</span></code> in the R
lingo) in our previous cell. We can just use it in subsequent cells.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">R</span> <span class="o">-</span><span class="n">w</span> <span class="m">800</span> <span class="o">--</span><span class="n">type</span><span class="o">=</span><span class="n">cairo</span>

<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;Running an R code cell.\n&quot;</span><span class="p">)</span>

<span class="n">p</span> <span class="o">&lt;-</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">dataf</span><span class="p">)</span> <span class="o">+</span>
     <span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">longd</span><span class="p">,</span>
         <span class="n">y</span><span class="o">=</span><span class="n">latd</span><span class="p">,</span>
         <span class="n">color</span><span class="o">=</span><span class="n">population_total</span><span class="p">,</span>
         <span class="n">size</span><span class="o">=</span><span class="n">area_total_km2</span><span class="p">)</span> <span class="o">+</span>
     <span class="nf">geom_point</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.5</span><span class="p">)</span> <span class="o">+</span>
     <span class="nf">scale_x_continuous</span><span class="p">(</span><span class="s">&#39;Longitude&#39;</span><span class="p">)</span> <span class="o">+</span>
     <span class="nf">scale_y_continuous</span><span class="p">(</span><span class="s">&#39;Latitude&#39;</span><span class="p">)</span> <span class="o">+</span>
     <span class="nf">scale_size</span><span class="p">(</span><span class="n">range</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">18</span><span class="p">))</span> <span class="o">+</span>
     <span class="nf">scale_color_viridis</span><span class="p">(</span><span class="n">trans</span><span class="o">=</span><span class="s">&#39;log10&#39;</span><span class="p">)</span> <span class="o">+</span>
     <span class="nf">ggtitle</span><span class="p">(</span><span class="s">&#39;California Cities: Area and Population&#39;</span><span class="p">)</span> <span class="o">+</span>
     <span class="nf">theme_light</span><span class="p">(</span><span class="n">base_size</span><span class="o">=</span><span class="m">16</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Running</span> <span class="n">an</span> <span class="n">R</span> <span class="n">code</span> <span class="n">cell</span><span class="o">.</span>
</pre></div>
</div>
<img alt="../_images/jupyter_28_1.png" src="../_images/jupyter_28_1.png" />
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Using rpy2 in notebooks</a><ul>
<li><a class="reference internal" href="#data-import">Data Import</a></li>
<li><a class="reference internal" href="#graphics">Graphics</a><ul>
<li><a class="reference internal" href="#using-ggplot2">Using <code class="docutils literal notranslate"><span class="pre">ggplot2</span></code></a></li>
<li><a class="reference internal" href="#using-ggplot2-extensions">Using <code class="docutils literal notranslate"><span class="pre">ggplot2</span></code> extensions</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../introduction.html"
                        title="previous chapter">Introduction to rpy2</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="pandas.html"
                        title="next chapter"><code class="docutils literal notranslate"><span class="pre">R</span></code> and <code class="docutils literal notranslate"><span class="pre">pandas</span></code> data frames</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/generated_rst/notebooks.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="pandas.html" title="R and pandas data frames"
             >next</a> |</li>
        <li class="right" >
          <a href="../introduction.html" title="Introduction to rpy2"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">rpy2 3.4.5 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../getting-started.html" >Getting started</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Using rpy2 in notebooks</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2008-2017, Laurent Gautier &amp; rpy2 contributors.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.0.2.
    </div>
  </body>
</html>