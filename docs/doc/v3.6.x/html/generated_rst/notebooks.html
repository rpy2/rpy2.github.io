
<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Using rpy2 in notebooks &#8212; rpy2 3.6.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/bizstyle.css?v=5283bb3d" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=4ae1632d" />
    
    <script src="../_static/documentation_options.js?v=f731707b"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="R and pandas data frames" href="pandas.html" />
    <link rel="prev" title="Introduction to rpy2" href="../introduction.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <!--[if lt IE 9]>
    <script src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="pandas.html" title="R and pandas data frames"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../introduction.html" title="Introduction to rpy2"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">rpy2 3.6.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../getting-started.html" accesskey="U">Getting started</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Using rpy2 in notebooks</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="using-rpy2-in-notebooks">
<h1>Using rpy2 in notebooks<a class="headerlink" href="#using-rpy2-in-notebooks" title="Link to this heading">¶</a></h1>
<p><cite>rpy2</cite> is designed to play well with notebooks. While the target
notebook is jupyter, it is used in other notebook systems (some of
them are based on <a class="reference external" href="https://jupyter.org/">Jupyter</a>, or are managed Jupyter notebook systems).</p>
<p>rpy2 is working, and is sometimes available by default, with
<a class="reference external" href="https://research.google.com/colaboratory/faq.html">Google’s Colab</a>,
<a class="reference external" href="https://docs.databricks.com/notebooks/index.html">Databricks notebooks</a>, <a class="reference external" href="https://docs.aws.amazon.com/sagemaker/latest/dg/nbi.html">AWS SageMaker</a>, <a class="reference external" href="https://notebooks.azure.com/">Azure Notebooks</a>,
or <a class="reference external" href="https://cloud.google.com/ai-platform-notebooks">Google Cloud AI Platform Notebooks</a>.</p>
<p>This section shows how <cite>rpy2</cite> can be used to add everything R can offer
to Python notebooks.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This section is available as a jupyter notebook <a class="reference external" href="_static/notebooks/jupyter.ipynb">jupyter.ipynb</a> (HTML render: <a class="reference external" href="_static/notebooks/jupyter.html">jupyter.html</a>)</p>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rpy2.ipython</span><span class="w"> </span><span class="kn">import</span> <span class="n">html</span>
<span class="n">html</span><span class="o">.</span><span class="n">html_rdataframe</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="n">html</span><span class="o">.</span><span class="n">html_rdataframe</span><span class="p">,</span> <span class="n">table_class</span><span class="o">=</span><span class="s2">&quot;docutils&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">hostedtoolcache</span><span class="o">/</span><span class="n">Python</span><span class="o">/</span><span class="mf">3.10.17</span><span class="o">/</span><span class="n">x64</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.10</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">rpy2</span><span class="o">/</span><span class="n">rinterface</span><span class="o">/</span><span class="fm">__init__</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">1211</span><span class="p">:</span> <span class="ne">UserWarning</span><span class="p">:</span> <span class="n">Environment</span> <span class="n">variable</span> <span class="s2">&quot;LD_LIBRARY_PATH&quot;</span> <span class="n">redefined</span> <span class="n">by</span> <span class="n">R</span> <span class="ow">and</span> <span class="n">overriding</span> <span class="n">existing</span> <span class="n">variable</span><span class="o">.</span> <span class="n">Current</span><span class="p">:</span> <span class="s2">&quot;/opt/R/4.5.0/lib/R/lib:/usr/local/lib:/usr/lib/x86_64-linux-gnu:/usr/lib/jvm/temurin-17-jdk-amd64/lib/server:/opt/hostedtoolcache/Python/3.10.17/x64/lib:/opt/hostedtoolcache/Python/3.10.17/x64/lib&quot;</span><span class="p">,</span> <span class="n">R</span><span class="p">:</span> <span class="s2">&quot;/opt/R/4.5.0/lib/R/lib:/usr/local/lib:/usr/lib/x86_64-linux-gnu:/usr/lib/jvm/temurin-17-jdk-amd64/lib/server:/opt/R/4.5.0/lib/R/lib:/usr/local/lib:/usr/lib/x86_64-linux-gnu:/usr/lib/jvm/temurin-17-jdk-amd64/lib/server:/opt/hostedtoolcache/Python/3.10.17/x64/lib:/opt/hostedtoolcache/Python/3.10.17/x64/lib&quot;</span>
  <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">hostedtoolcache</span><span class="o">/</span><span class="n">Python</span><span class="o">/</span><span class="mf">3.10.17</span><span class="o">/</span><span class="n">x64</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.10</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">rpy2</span><span class="o">/</span><span class="n">rinterface</span><span class="o">/</span><span class="fm">__init__</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">1211</span><span class="p">:</span> <span class="ne">UserWarning</span><span class="p">:</span> <span class="n">Environment</span> <span class="n">variable</span> <span class="s2">&quot;PWD&quot;</span> <span class="n">redefined</span> <span class="n">by</span> <span class="n">R</span> <span class="ow">and</span> <span class="n">overriding</span> <span class="n">existing</span> <span class="n">variable</span><span class="o">.</span> <span class="n">Current</span><span class="p">:</span> <span class="s2">&quot;/home/runner/work/rpy2/rpy2/doc&quot;</span><span class="p">,</span> <span class="n">R</span><span class="p">:</span> <span class="s2">&quot;/home/runner/work/rpy2/rpy2/doc/notebooks&quot;</span>
  <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">hostedtoolcache</span><span class="o">/</span><span class="n">Python</span><span class="o">/</span><span class="mf">3.10.17</span><span class="o">/</span><span class="n">x64</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.10</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">rpy2</span><span class="o">/</span><span class="n">rinterface</span><span class="o">/</span><span class="fm">__init__</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">1211</span><span class="p">:</span> <span class="ne">UserWarning</span><span class="p">:</span> <span class="n">Environment</span> <span class="n">variable</span> <span class="s2">&quot;LD_LIBRARY_PATH&quot;</span> <span class="n">redefined</span> <span class="n">by</span> <span class="n">R</span> <span class="ow">and</span> <span class="n">overriding</span> <span class="n">existing</span> <span class="n">variable</span><span class="o">.</span> <span class="n">Current</span><span class="p">:</span> <span class="s2">&quot;/opt/R/4.5.0/lib/R/lib:/usr/local/lib:/usr/lib/x86_64-linux-gnu:/usr/lib/jvm/temurin-17-jdk-amd64/lib/server:/opt/R/4.5.0/lib/R/lib:/usr/local/lib:/usr/lib/x86_64-linux-gnu:/usr/lib/jvm/temurin-17-jdk-amd64/lib/server:/opt/hostedtoolcache/Python/3.10.17/x64/lib:/opt/hostedtoolcache/Python/3.10.17/x64/lib&quot;</span><span class="p">,</span> <span class="n">R</span><span class="p">:</span> <span class="s2">&quot;/opt/R/4.5.0/lib/R/lib:/usr/local/lib:/usr/lib/x86_64-linux-gnu:/usr/lib/jvm/temurin-17-jdk-amd64/lib/server:/opt/R/4.5.0/lib/R/lib:/usr/local/lib:/usr/lib/x86_64-linux-gnu:/usr/lib/jvm/temurin-17-jdk-amd64/lib/server:/opt/R/4.5.0/lib/R/lib:/usr/local/lib:/usr/lib/x86_64-linux-gnu:/usr/lib/jvm/temurin-17-jdk-amd64/lib/server:/opt/hostedtoolcache/Python/3.10.17/x64/lib:/opt/hostedtoolcache/Python/3.10.17/x64/lib&quot;</span>
  <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">hostedtoolcache</span><span class="o">/</span><span class="n">Python</span><span class="o">/</span><span class="mf">3.10.17</span><span class="o">/</span><span class="n">x64</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.10</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">rpy2</span><span class="o">/</span><span class="n">rinterface</span><span class="o">/</span><span class="fm">__init__</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">1211</span><span class="p">:</span> <span class="ne">UserWarning</span><span class="p">:</span> <span class="n">Environment</span> <span class="n">variable</span> <span class="s2">&quot;R_SESSION_TMPDIR&quot;</span> <span class="n">redefined</span> <span class="n">by</span> <span class="n">R</span> <span class="ow">and</span> <span class="n">overriding</span> <span class="n">existing</span> <span class="n">variable</span><span class="o">.</span> <span class="n">Current</span><span class="p">:</span> <span class="s2">&quot;/tmp/RtmpDEXZKB&quot;</span><span class="p">,</span> <span class="n">R</span><span class="p">:</span> <span class="s2">&quot;/tmp/RtmpGa9HQB&quot;</span>
  <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</pre></div>
</div>
<section id="data-import">
<h2>Data Import<a class="headerlink" href="#data-import" title="Link to this heading">¶</a></h2>
<p>We choose to use an external dataset to demonstrate how R’s own data
import features can be used.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">rpy2.robjects.packages</span><span class="w"> </span><span class="kn">import</span> <span class="n">importr</span>
<span class="n">utils</span> <span class="o">=</span> <span class="n">importr</span><span class="p">(</span><span class="s1">&#39;utils&#39;</span><span class="p">)</span>

<span class="n">dataf</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/jakevdp/PythonDataScienceHandbook/&#39;</span>
                       <span class="s1">&#39;master/notebooks_v1/data/california_cities.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The objects returned by R’s own <code class="docutils literal notranslate"><span class="pre">read.csv()</span></code> function (note that the R
function in the R package <code class="docutils literal notranslate"><span class="pre">utils</span></code> is called <code class="docutils literal notranslate"><span class="pre">read.csv()</span></code> while the
Python function is called <code class="docutils literal notranslate"><span class="pre">read_csv()</span></code> - <code class="docutils literal notranslate"><span class="pre">rpy2</span></code> converts R symbols
with dots to underscores for Python).</p>
<p><code class="docutils literal notranslate"><span class="pre">rpy2</span></code> provides customization to display R objects such as data frames
in HTML in a notebook. That customization is enabled as follows:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">rpy2.ipython.html</span>
<span class="n">rpy2</span><span class="o">.</span><span class="n">ipython</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">init_printing</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataf</span>
</pre></div>
</div>
<emph>DataFrame</emph> with 482 rows and
  14 columns:
<table class="docutils">
  <thead>
    <tr class="rpy2_names">
      <th></th>
      <th></th>
      <th>X</th>
      <th>city</th>
      <th>latd</th>
      <th>longd</th>
      <th>...</th>
      <th>area_water_km2</th>
      <th>area_water_percent</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td class="rpy2_rowname">0</td>
        <td class="rpy2_names">1</td>
      <td>0</td>
      <td>Adelanto</td>
      <td>34.57611111111112</td>
      <td>-117.43277777777779</td>
       <td>...</td>
      <td>0.046</td>
      <td>0.03</td>
    </tr>
    <tr>
      <td class="rpy2_rowname">1</td>
        <td class="rpy2_names">2</td>
      <td>1</td>
      <td>AgouraHills</td>
      <td>34.15333333333333</td>
      <td>-118.76166666666667</td>
       <td>...</td>
      <td>0.076</td>
      <td>0.37</td>
    </tr>
    <tr>
      <td class="rpy2_rowname">2</td>
        <td class="rpy2_names">3</td>
      <td>2</td>
      <td>Alameda</td>
      <td>37.75611111111111</td>
      <td>-122.27444444444444</td>
       <td>...</td>
      <td>31.983</td>
      <td>53.79</td>
    </tr>
    <tr>
      <td class="rpy2_rowname">3</td>
        <td class="rpy2_names">4</td>
      <td>3</td>
      <td>Albany</td>
      <td>37.886944444444445</td>
      <td>-122.29777777777778</td>
       <td>...</td>
      <td>9.524</td>
      <td>67.28</td>
    </tr>
    <tr>
      <td class="rpy2_rowname">4</td>
        <td class="rpy2_names">5</td>
      <td>4</td>
      <td>Alhambra</td>
      <td>34.081944444444446</td>
      <td>-118.135</td>
       <td>...</td>
      <td>0.003</td>
      <td>0.01</td>
    </tr>
    <tr>
      <td class="rpy2_rowname">5</td>
        <td class="rpy2_names">6</td>
      <td>5</td>
      <td>AlisoViejo</td>
      <td>33.575</td>
      <td>-117.72555555555556</td>
       <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <td class="rpy2_rowname">6</td>
        <td class="rpy2_names">7</td>
      <td>6</td>
      <td>Alturas</td>
      <td>41.48722222222222</td>
      <td>-120.5425</td>
       <td>...</td>
      <td>0.036000000000000004</td>
      <td>0.57</td>
    </tr>
    <tr>
      <td class="rpy2_rowname">7</td>
        <td class="rpy2_names">8</td>
      <td>7</td>
      <td>AmadorCity</td>
      <td>38.419444444444444</td>
      <td>-120.82416666666666</td>
       <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <td class="rpy2_rowname">...</td>
        <td class="rpy2_names">...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
       <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <td class="rpy2_rowname">480</td>
        <td class="rpy2_names">481</td>
      <td>480</td>
      <td>Yucaipa</td>
      <td>34.030277777777776</td>
      <td>-117.04861111111111</td>
       <td>...</td>
      <td>0.013000000000000001</td>
      <td>0.02</td>
    </tr>
    <tr>
      <td class="rpy2_rowname">481</td>
        <td class="rpy2_names">482</td>
      <td>481</td>
      <td>YuccaValley</td>
      <td>34.13333333333333</td>
      <td>-116.41666666666667</td>
       <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table><div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataf</span><span class="o">.</span><span class="n">colnames</span>
</pre></div>
</div>
<emph>StrVector</emph> with 14 elements:
<table class="rpy2_table">
<thead>
</thead>
<tbody>
<tr>
  <td>X</td>
  <td>city</td>
  <td>latd</td>
  <td>longd</td>
  <td>elevation_m</td>
  <td>elevation_ft</td>
  <td>population_total</td>
  <td>area_total_sq_mi</td>
  <td>...</td>
      <td>area_water_km2</td>
      <td>area_water_percent</td>
</tr>
</tbody>
</table><div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stats</span> <span class="o">=</span> <span class="n">importr</span><span class="p">(</span><span class="s1">&#39;stats&#39;</span><span class="p">)</span>
<span class="n">base</span> <span class="o">=</span> <span class="n">importr</span><span class="p">(</span><span class="s1">&#39;base&#39;</span><span class="p">)</span>
<span class="n">fit</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">lm</span><span class="p">(</span><span class="s1">&#39;elevation_m ~ latd + longd&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">dataf</span><span class="p">)</span>
<span class="n">fit</span>
</pre></div>
</div>
<emph>ListVector</emph> with 13 elements:
<table class="rpy2_table">
<thead>
</thead>
<tbody>
  <tr>
    <td class="rpy2_rowname">0</td>
    <td class="rpy2_names">coefficients</td>
    <td>(Intercep...</td>
  </tr>
  <tr>
    <td class="rpy2_rowname">1</td>
    <td class="rpy2_names">residuals</td>
    <td>        ...</td>
  </tr>
  <tr>
    <td class="rpy2_rowname">2</td>
    <td class="rpy2_names">effects</td>
    <td> ...</td>
  </tr>
  <tr>
    <td class="rpy2_rowname">3</td>
    <td class="rpy2_names">rank</td>
    <td>[1] 3
</td>
  </tr>
  <tr>
    <td class="rpy2_rowname">4</td>
    <td class="rpy2_names">fitted.values</td>
    <td>        ...</td>
  </tr>
  <tr>
    <td class="rpy2_rowname">5</td>
    <td class="rpy2_names">assign</td>
    <td>[1] 0 1 2
</td>
  </tr>
  <tr>
    <td class="rpy2_rowname">6</td>
    <td class="rpy2_names">qr</td>
    <td>$qr
    ...</td>
  </tr>
  <tr>
    <td class="rpy2_rowname">7</td>
    <td class="rpy2_names">df.residual</td>
    <td>[1] 431
</td>
  </tr>
  <tr>
    <td class="rpy2_rowname">...</td>
    <td class="rpy2_names">...</td>
    <td>...</td>
  </tr>
  <tr>
    <td class="rpy2_rowname">11</td>
    <td class="rpy2_names">terms</td>
    <td>elevation...</td>
  </tr>
  <tr>
    <td class="rpy2_rowname">12</td>
    <td class="rpy2_names">model</td>
    <td>   ...</td>
  </tr>
</tr>
</tbody>
</table></section>
<section id="graphics">
<h2>Graphics<a class="headerlink" href="#graphics" title="Link to this heading">¶</a></h2>
<p>R has arguably some the best static visualizations, often looking more
polished than other visualization systems and this without the need to
spend much effort on them.</p>
<section id="using-ggplot2">
<h3>Using <code class="docutils literal notranslate"><span class="pre">ggplot2</span></code><a class="headerlink" href="#using-ggplot2" title="Link to this heading">¶</a></h3>
<p>Among R visulization pacakges, <code class="docutils literal notranslate"><span class="pre">ggplot2</span></code> has emerged as something
Python users wished so much they had that various projects to try port
it to Python are regularly started.</p>
<p>However, the best way to have <code class="docutils literal notranslate"><span class="pre">ggplot2</span></code> might be to use <code class="docutils literal notranslate"><span class="pre">ggplot2</span></code>
from Python.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">rpy2.robjects.lib.ggplot2</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">gp</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">hostedtoolcache</span><span class="o">/</span><span class="n">Python</span><span class="o">/</span><span class="mf">3.10.17</span><span class="o">/</span><span class="n">x64</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.10</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">rpy2</span><span class="o">/</span><span class="n">robjects</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">ggplot2</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">76</span><span class="p">:</span> <span class="ne">UserWarning</span><span class="p">:</span> <span class="n">This</span> <span class="n">was</span> <span class="n">designed</span> <span class="n">against</span> <span class="n">ggplot2</span> <span class="n">versions</span> <span class="n">starting</span> <span class="k">with</span> <span class="mf">3.5</span><span class="o">.</span> <span class="n">but</span> <span class="n">you</span> <span class="n">have</span> <span class="mf">3.5.2</span><span class="o">.</span>
  <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</pre></div>
</div>
<p>R lets is function parameters be unevaluated language objects, which is
fairly different from Python’s immediate evaluation. <code class="docutils literal notranslate"><span class="pre">rpy2</span></code> has a
utility code to create such R language objects from Python strings. It
can then become very easy to mix Python and R, with R like a
domain-specific language used from Python.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">rpy2.robjects</span><span class="w"> </span><span class="kn">import</span> <span class="n">rl</span>
</pre></div>
</div>
<p>Calling <code class="docutils literal notranslate"><span class="pre">ggplot2</span></code> looks pretty much like it would in R, which allows
one to use the all available documentation and examples available for
the R package. Remember that this is not a reimplementation of ggplot2
with inevitable differences and delay for having the latest changes: the
R package itself is generating the figures.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">ggplot</span><span class="p">(</span><span class="n">dataf</span><span class="p">)</span> <span class="o">+</span>
     <span class="n">gp</span><span class="o">.</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">rl</span><span class="p">(</span><span class="s1">&#39;longd&#39;</span><span class="p">),</span>
            <span class="n">y</span><span class="o">=</span><span class="n">rl</span><span class="p">(</span><span class="s1">&#39;latd&#39;</span><span class="p">),</span>
            <span class="n">color</span><span class="o">=</span><span class="n">rl</span><span class="p">(</span><span class="s1">&#39;population_total&#39;</span><span class="p">),</span>
            <span class="n">size</span><span class="o">=</span><span class="n">rl</span><span class="p">(</span><span class="s1">&#39;area_total_km2&#39;</span><span class="p">))</span> <span class="o">+</span>
     <span class="n">gp</span><span class="o">.</span><span class="n">geom_point</span><span class="p">()</span> <span class="o">+</span>
     <span class="n">gp</span><span class="o">.</span><span class="n">scale_color_continuous</span><span class="p">(</span><span class="n">trans</span><span class="o">=</span><span class="s1">&#39;log10&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>Plotting the resulting R/ggplot2 object into the output cell of a
notebook, is just function call away.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">rpy2.ipython.ggplot</span><span class="w"> </span><span class="kn">import</span> <span class="n">image_png</span>
<span class="n">image_png</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>R callback write-console: In addition:
R callback write-console: Warning messages:

R callback write-console: 1:
R callback write-console: In (function (package, help, pos = 2, lib.loc = NULL, character.only = FALSE,  :
R callback write-console:

R callback write-console:  library ‘/home/runner/work/_temp/Library’ contains no packages

R callback write-console: 2:
R callback write-console: In (function (package, help, pos = 2, lib.loc = NULL, character.only = FALSE,  :
R callback write-console:

R callback write-console:  library ‘/home/runner/work/_temp/Library’ contains no packages

R callback write-console: 3:
R callback write-console: In (function (package, help, pos = 2, lib.loc = NULL, character.only = FALSE,  :
R callback write-console:

R callback write-console:  library ‘/home/runner/work/_temp/Library’ contains no packages

R callback write-console: 4:
R callback write-console: In (function (package, help, pos = 2, lib.loc = NULL, character.only = FALSE,  :
R callback write-console:

R callback write-console:  library ‘/home/runner/work/_temp/Library’ contains no packages

R callback write-console: 5:
R callback write-console: In (function (package, help, pos = 2, lib.loc = NULL, character.only = FALSE,  :
R callback write-console:

R callback write-console:  library ‘/home/runner/work/_temp/Library’ contains no packages

R callback write-console: 6:
R callback write-console: In (function (package, help, pos = 2, lib.loc = NULL, character.only = FALSE,  :
R callback write-console:

R callback write-console:  library ‘/home/runner/work/_temp/Library’ contains no packages

R callback write-console: 7:
R callback write-console: In (function (package, help, pos = 2, lib.loc = NULL, character.only = FALSE,  :
R callback write-console:

R callback write-console:  library ‘/home/runner/work/_temp/Library’ contains no packages

R callback write-console: 8:
R callback write-console: In (function (package, help, pos = 2, lib.loc = NULL, character.only = FALSE,  :
R callback write-console:

R callback write-console:  library ‘/home/runner/work/_temp/Library’ contains no packages
</pre></div>
</div>
<img alt="../_images/jupyter_15_1.png" src="../_images/jupyter_15_1.png" />
<p>All features from <code class="docutils literal notranslate"><span class="pre">ggplot2</span></code> should be present. A more complex example
to get the figure we want is:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">rpy2.robjects.vectors</span><span class="w"> </span><span class="kn">import</span> <span class="n">IntVector</span>
<span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">ggplot</span><span class="p">(</span><span class="n">dataf</span><span class="p">)</span> <span class="o">+</span>
     <span class="n">gp</span><span class="o">.</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">rl</span><span class="p">(</span><span class="s1">&#39;longd&#39;</span><span class="p">),</span>
            <span class="n">y</span><span class="o">=</span><span class="n">rl</span><span class="p">(</span><span class="s1">&#39;latd&#39;</span><span class="p">),</span>
            <span class="n">color</span><span class="o">=</span><span class="n">rl</span><span class="p">(</span><span class="s1">&#39;population_total&#39;</span><span class="p">),</span>
            <span class="n">size</span><span class="o">=</span><span class="n">rl</span><span class="p">(</span><span class="s1">&#39;area_total_km2&#39;</span><span class="p">))</span> <span class="o">+</span>
     <span class="n">gp</span><span class="o">.</span><span class="n">geom_point</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span> <span class="o">+</span>
     <span class="c1"># Axis definitions.</span>
     <span class="n">gp</span><span class="o">.</span><span class="n">scale_x_continuous</span><span class="p">(</span><span class="s1">&#39;Longitude&#39;</span><span class="p">)</span> <span class="o">+</span>
     <span class="n">gp</span><span class="o">.</span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="s1">&#39;Latitude&#39;</span><span class="p">)</span> <span class="o">+</span>
     <span class="c1"># Custom size range.</span>
     <span class="n">gp</span><span class="o">.</span><span class="n">scale_size</span><span class="p">(</span><span class="nb">range</span><span class="o">=</span><span class="n">IntVector</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">18</span><span class="p">]))</span> <span class="o">+</span>
     <span class="c1"># Transform for pop -&gt; color mapping</span>
     <span class="n">gp</span><span class="o">.</span><span class="n">scale_color_continuous</span><span class="p">(</span><span class="n">trans</span><span class="o">=</span><span class="s1">&#39;log10&#39;</span><span class="p">)</span> <span class="o">+</span>
     <span class="c1"># Title.</span>
     <span class="n">gp</span><span class="o">.</span><span class="n">ggtitle</span><span class="p">(</span><span class="s1">&#39;California Cities: Area and Population&#39;</span><span class="p">)</span> <span class="o">+</span>
     <span class="c1"># Plot theme and text size.</span>
     <span class="n">gp</span><span class="o">.</span><span class="n">theme_light</span><span class="p">(</span><span class="n">base_size</span><span class="o">=</span><span class="mi">16</span><span class="p">))</span>
<span class="n">image_png</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
<pre class="literal-block">R callback write-console: In addition:
R callback write-console: Warning message:

R callback write-console: Removed 5 rows containing missing values or values outside the scale range
(<cite>geom_point()</cite>).</pre>
<img alt="../_images/jupyter_17_1.png" src="../_images/jupyter_17_1.png" />
</section>
<section id="using-ggplot2-extensions">
<h3>Using <code class="docutils literal notranslate"><span class="pre">ggplot2</span></code> extensions<a class="headerlink" href="#using-ggplot2-extensions" title="Link to this heading">¶</a></h3>
<p>There existing additional R packages extending <code class="docutils literal notranslate"><span class="pre">ggplot2</span></code>, and while it
would be impossible for the rpy2 to provide wrapper for all of them the
wrapper for <code class="docutils literal notranslate"><span class="pre">ggplot2</span></code> is based on class hierarchies that should make
the use of such extensions really easy.</p>
<p>For example, to use the viridis color scale, we just need to import the
corresponding R package, and write 3 lines of Python to extend
<code class="docutils literal notranslate"><span class="pre">rpy2</span></code>’s ggplot2 wrapper with a new color scale. A clas diagram with
the classes in the rpy2 wrapper for ggplot2 is available in the rpy2
documentation.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">viridis</span> <span class="o">=</span> <span class="n">importr</span><span class="p">(</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ScaleColorViridis</span><span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">ScaleColour</span><span class="p">):</span>
    <span class="n">_constructor</span> <span class="o">=</span> <span class="n">viridis</span><span class="o">.</span><span class="n">scale_color_viridis</span>
<span class="n">scale_color_viridis</span> <span class="o">=</span> <span class="n">ScaleColorViridis</span><span class="o">.</span><span class="n">new</span>
</pre></div>
</div>
<p>That new color scale can then be used as any other scale already present
in <code class="docutils literal notranslate"><span class="pre">ggplot2</span></code>:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">ggplot</span><span class="p">(</span><span class="n">dataf</span><span class="p">)</span> <span class="o">+</span>
     <span class="n">gp</span><span class="o">.</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">rl</span><span class="p">(</span><span class="s1">&#39;longd&#39;</span><span class="p">),</span>
            <span class="n">y</span><span class="o">=</span><span class="n">rl</span><span class="p">(</span><span class="s1">&#39;latd&#39;</span><span class="p">),</span>
            <span class="n">color</span><span class="o">=</span><span class="n">rl</span><span class="p">(</span><span class="s1">&#39;population_total&#39;</span><span class="p">),</span>
            <span class="n">size</span><span class="o">=</span><span class="n">rl</span><span class="p">(</span><span class="s1">&#39;area_total_km2&#39;</span><span class="p">))</span> <span class="o">+</span>
     <span class="n">gp</span><span class="o">.</span><span class="n">geom_point</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span> <span class="o">+</span>
     <span class="n">gp</span><span class="o">.</span><span class="n">scale_x_continuous</span><span class="p">(</span><span class="s1">&#39;Longitude&#39;</span><span class="p">)</span> <span class="o">+</span>
     <span class="n">gp</span><span class="o">.</span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="s1">&#39;Latitude&#39;</span><span class="p">)</span> <span class="o">+</span>
     <span class="n">gp</span><span class="o">.</span><span class="n">scale_size</span><span class="p">(</span><span class="nb">range</span><span class="o">=</span><span class="n">IntVector</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">18</span><span class="p">]))</span> <span class="o">+</span>
     <span class="n">scale_color_viridis</span><span class="p">(</span><span class="n">trans</span><span class="o">=</span><span class="s1">&#39;log10&#39;</span><span class="p">)</span> <span class="o">+</span>
     <span class="n">gp</span><span class="o">.</span><span class="n">ggtitle</span><span class="p">(</span><span class="s1">&#39;California Cities: Area and Population&#39;</span><span class="p">)</span> <span class="o">+</span>
     <span class="n">gp</span><span class="o">.</span><span class="n">theme_light</span><span class="p">(</span><span class="n">base_size</span><span class="o">=</span><span class="mi">16</span><span class="p">))</span>
<span class="n">image_png</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
<pre class="literal-block">R callback write-console: In addition:
R callback write-console: Warning messages:

R callback write-console: 1: Removed 5 rows containing missing values or values outside the scale range
(<cite>geom_point()</cite>).

R callback write-console: 2:
R callback write-console: In (function (package, help, pos = 2, lib.loc = NULL, character.only = FALSE,  :
R callback write-console:

R callback write-console:  library ‘/home/runner/work/_temp/Library’ contains no packages</pre>
<img alt="../_images/jupyter_21_1.png" src="../_images/jupyter_21_1.png" />
</section>
</section>
<section id="r-magics">
<h2>R “magics”<a class="headerlink" href="#r-magics" title="Link to this heading">¶</a></h2>
<p>So far we have shown that using <code class="docutils literal notranslate"><span class="pre">ggplot2</span></code> can be done from Python as
if it was just an other Python library for visualization, but R can also
be used in cells.</p>
<p>First the so-called “R magic” extensions should be loaded.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> rpy2.ipython
</pre></div>
</div>
<p>From now on, code cells starting with <code class="docutils literal notranslate"><span class="pre">%%R</span></code> will see their content
evaluated as R code. If the R code is generating figures, they will be
displayed along with the rest of the output.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">R</span>
<span class="n">R.version.string</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="s2">&quot;R version 4.5.0 (2025-04-11)&quot;</span>
</pre></div>
</div>
<pre class="literal-block">In addition: Warning message:
Removed 5 rows containing missing values or values outside the scale range
(<cite>geom_point()</cite>).</pre>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">R</span><span class="w"> </span><span class="o">-</span><span class="n">i</span><span class="w"> </span><span class="n">dataf</span>

<span class="nf">require</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span>
<span class="nf">glimpse</span><span class="p">(</span><span class="n">dataf</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Rows: 482
Columns: 14
$ X                  &lt;int&gt; 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 1…
$ city               &lt;chr&gt; &quot;Adelanto&quot;, &quot;AgouraHills&quot;, &quot;Alameda&quot;, &quot;Albany&quot;, &quot;Al…
$ latd               &lt;dbl&gt; 34.57611, 34.15333, 37.75611, 37.88694, 34.08194, 3…
$ longd              &lt;dbl&gt; -117.4328, -118.7617, -122.2744, -122.2978, -118.13…
$ elevation_m        &lt;dbl&gt; 875, 281, NA, NA, 150, 127, 1332, 280, 14, 48, 132,…
$ elevation_ft       &lt;dbl&gt; 2871, 922, 33, 43, 492, 417, 4370, 919, 46, 157, 43…
$ population_total   &lt;int&gt; 31765, 20330, 75467, 18969, 83089, 47823, 2827, 185…
$ area_total_sq_mi   &lt;dbl&gt; 56.027, 7.822, 22.960, 5.465, 7.632, 7.472, 2.449, …
$ area_land_sq_mi    &lt;dbl&gt; 56.009, 7.793, 10.611, 1.788, 7.631, 7.472, 2.435, …
$ area_water_sq_mi   &lt;dbl&gt; 0.018, 0.029, 12.349, 3.677, 0.001, 0.000, 0.014, 0…
$ area_total_km2     &lt;dbl&gt; 145.107, 20.260, 59.465, 14.155, 19.766, 19.352, 6.…
$ area_land_km2      &lt;dbl&gt; 145.062, 20.184, 27.482, 4.632, 19.763, 19.352, 6.3…
$ area_water_km2     &lt;dbl&gt; 0.046, 0.076, 31.983, 9.524, 0.003, 0.000, 0.036, 0…
$ area_water_percent &lt;dbl&gt; 0.03, 0.37, 53.79, 67.28, 0.01, 0.00, 0.57, 0.00, 0…
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Loading required package: dplyr

Attaching package: ‘dplyr’

The following objects are masked from ‘package:stats’:

    filter, lag

The following objects are masked from ‘package:base’:

    intersect, setdiff, setequal, union
</pre></div>
</div>
<p>The data frame called <code class="docutils literal notranslate"><span class="pre">dataf</span></code> in our Python notebook was already bound
to the name <code class="docutils literal notranslate"><span class="pre">dataf</span></code> in the R main namespace (<code class="docutils literal notranslate"><span class="pre">GlobalEnv</span></code> in the R
lingo) in our previous cell. We can just use it in subsequent cells.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">R</span><span class="w"> </span><span class="o">-</span><span class="n">w</span><span class="w"> </span><span class="m">800</span><span class="w"> </span><span class="o">--</span><span class="n">type</span><span class="o">=</span><span class="n">cairo</span>

<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;Running an R code cell.\n&quot;</span><span class="p">)</span>

<span class="n">p</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">dataf</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">     </span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">longd</span><span class="p">,</span>
<span class="w">         </span><span class="n">y</span><span class="o">=</span><span class="n">latd</span><span class="p">,</span>
<span class="w">         </span><span class="n">color</span><span class="o">=</span><span class="n">population_total</span><span class="p">,</span>
<span class="w">         </span><span class="n">size</span><span class="o">=</span><span class="n">area_total_km2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">     </span><span class="nf">geom_point</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.5</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">     </span><span class="nf">scale_x_continuous</span><span class="p">(</span><span class="s">&#39;Longitude&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">     </span><span class="nf">scale_y_continuous</span><span class="p">(</span><span class="s">&#39;Latitude&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">     </span><span class="nf">scale_size</span><span class="p">(</span><span class="n">range</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">18</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">     </span><span class="nf">scale_color_viridis</span><span class="p">(</span><span class="n">trans</span><span class="o">=</span><span class="s">&#39;log10&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">     </span><span class="nf">ggtitle</span><span class="p">(</span><span class="s">&#39;California Cities: Area and Population&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">     </span><span class="nf">theme_light</span><span class="p">(</span><span class="n">base_size</span><span class="o">=</span><span class="m">16</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Running</span> <span class="n">an</span> <span class="n">R</span> <span class="n">code</span> <span class="n">cell</span><span class="o">.</span>
</pre></div>
</div>
<pre class="literal-block">In addition: Warning message:
Removed 5 rows containing missing values or values outside the scale range
(<cite>geom_point()</cite>).</pre>
<img alt="../_images/jupyter_28_2.png" src="../_images/jupyter_28_2.png" />
<section id="options">
<h3>Options.<a class="headerlink" href="#options" title="Link to this heading">¶</a></h3>
<p>The R “magics” use a number of configurable options that control aspects
of the interaction between Python and R, or between ipython / jupyter
and R. Some of the options can specified through arguments to “magics”,
but it is also possible to configure the default value for some of them
when an argument to a “magic” does not specify otherwise. The easiest
way to list these default-configurable options can be achieved with a
“magic”:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">Roptions</span> show
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Default settings for R magics.
------------------------------
&lt;rpy2.ipython.rmagic.Options object at 0x7ff95f6139a0&gt;
  - graphics device
      requested: png
      found: grDevices::png
        &lt;rpy2.ipython.rmagic.GraphicsDeviceRaster object at 0x7ff9bdedddb0&gt;:
        grDevices::png
        (extension: png)
        Options and default values:
          width: None
          height: None
          pointsize: None
          bg: None
          units: None
          res: None
  - converter
    &lt;class &#39;rpy2.robjects.conversion.Converter&#39;&gt;
    py2rpy
    - builtins.object
    - rpy2.rinterface._MissingArgType
    - builtins.bool
    - builtins.int
    - builtins.float
    - builtins.bytes
    - builtins.str
    - rpy2.robjects.robject.RObject
    - rpy2.rinterface_lib.sexp.Sexp
    - array.array
    - builtins.list
    - rpy2.rlike.container.TaggedList
    - rpy2.rlike.container.NamedList
    - builtins.complex
    - builtins.function
    - numpy.ndarray
    - numpy.integer
    - numpy.floating
    - rpy2.rlike.container.OrdDict
    - pandas.core.frame.DataFrame
    - pandas.core.indexes.base.Index
    - pandas.core.arrays.categorical.Categorical
    - pandas.core.series.Series
    ---
    rpy2py
    - builtins.object
    - rpy2.robjects.robject.RObject
    - rpy2.rinterface.IntSexpVector
      - factor (in rpy2.robjects.pandas2ri)
    - rpy2.rinterface.FloatSexpVector
      - Date (in rpy2.robjects.vectors)
      - POSIXct (in rpy2.robjects.vectors)
    - rpy2.rinterface.ComplexSexpVector
    - rpy2.rinterface.BoolSexpVector
    - rpy2.rinterface_lib.sexp.StrSexpVector
    - rpy2.rinterface.ByteSexpVector
    - rpy2.rinterface.PairlistSexpVector
    - rpy2.rinterface.LangSexpVector
    - rpy2.rinterface.SexpClosure
    - rpy2.rinterface_lib.sexp.SexpEnvironment
    - rpy2.rinterface.ListSexpVector
      - data.frame (in rpy2.robjects.pandas2ri)
    - rpy2.rinterface.SexpS4
    - rpy2.rinterface.SexpExtPtr
    - rpy2.rinterface_lib.sexp.NULLType
    - rpy2.rinterface_lib.sexp.CharSexp
    - rpy2.rinterface_lib.sexp.Sexp
    - rpy2.rinterface_lib.sexp.SexpVector
    - rpy2.robjects.vectors.POSIXct
    - rpy2.robjects.vectors.DataFrame
    ---
</pre></div>
</div>
<p>Changing these defaults requires to modify components of the attribute
:attr:<code class="docutils literal notranslate"><span class="pre">rpy2.ipython.rmagic.RMagic.options</span></code>. Here is an example showing
how to changing the default of R figures rendered in the notebook to
“svg”.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">IPython</span>
<span class="n">ipy</span> <span class="o">=</span> <span class="n">IPython</span><span class="o">.</span><span class="n">get_ipython</span><span class="p">()</span>
<span class="n">ipy</span><span class="o">.</span><span class="n">magics_manager</span><span class="o">.</span><span class="n">registry</span><span class="p">[</span><span class="s1">&#39;RMagics&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">graphics_device_name</span> <span class="o">=</span> <span class="s1">&#39;svg&#39;</span>
</pre></div>
</div>
<p>Another example is how to change conversion rules, that can be an
expensive operation depending object sizes and rules, to a no-op: no
convertion rules to keep all rpy2 objects as proxy wrappers to R objects
for example, no conversion of Python objects to R:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">rpy2.robjects</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">IPython</span>
<span class="n">ipy</span> <span class="o">=</span> <span class="n">IPython</span><span class="o">.</span><span class="n">get_ipython</span><span class="p">()</span>

<span class="n">noop_conv</span> <span class="o">=</span> <span class="n">rpy2</span><span class="o">.</span><span class="n">robjects</span><span class="o">.</span><span class="n">conversion</span><span class="o">.</span><span class="n">Converter</span><span class="p">(</span><span class="s1">&#39;No-Op&#39;</span><span class="p">)</span>
<span class="n">noop_conv</span><span class="o">.</span><span class="n">rpy2py</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">rpy2</span><span class="o">.</span><span class="n">robjects</span><span class="o">.</span><span class="n">RObject</span><span class="p">,</span>
                          <span class="n">rpy2</span><span class="o">.</span><span class="n">robjects</span><span class="o">.</span><span class="n">_rpy2py_robject</span><span class="p">)</span>

<span class="n">ipy</span><span class="o">.</span><span class="n">magics_manager</span><span class="o">.</span><span class="n">registry</span><span class="p">[</span><span class="s1">&#39;RMagics&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">converter</span> <span class="o">=</span> <span class="n">noop_conv</span>
</pre></div>
</div>
<p>Modifying this come with risks though, or afterthoughts about changes
made. While there are some checks in place, the new default options set
this way may break the R “magics”. To address this, options can be
restore to “factory settings”. Here again, there is no guarantee that
this can work no matter what. A driven (or unlucky) user may break this
mechanism if modifying it in the module. Restarting kernel will be
needed in that case.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">Roptions</span> refresh
</pre></div>
</div>
</section>
<section id="graphics-devices">
<h3>Graphics devices<a class="headerlink" href="#graphics-devices" title="Link to this heading">¶</a></h3>
<p>Graphics devices can be specified precisely as a function in an R
namespace. For example, “grDevices:png”. It is also possible to specify
a generic graphical device name that is a sequence of graphics devices
to try. The first one in that sequence that appears to be functioning is
then selected.</p>
<p>For example, this is the case when the graphics device option is set to
“svg”. The R package <code class="docutils literal notranslate"><span class="pre">svglite</span></code> is the first to try in the sequence. If
R fails to load that package there are other SVG devices to try try as
alternatives.</p>
<p>To demonstrate this, let’s set the graphics devices to “svg”:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">IPython</span>
<span class="n">ipy</span> <span class="o">=</span> <span class="n">IPython</span><span class="o">.</span><span class="n">get_ipython</span><span class="p">()</span>
<span class="n">ipy</span><span class="o">.</span><span class="n">magics_manager</span><span class="o">.</span><span class="n">registry</span><span class="p">[</span><span class="s1">&#39;RMagics&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">graphics_device_name</span> <span class="o">=</span> <span class="s1">&#39;svg&#39;</span>
</pre></div>
</div>
<p>The output of the following magic depends on the R packages installed on
your system. If the R package <code class="docutils literal notranslate"><span class="pre">svglite</span></code> is installed its device will
be used. Otherwise alternatives will be tried.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">Roptions</span> show
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Default settings for R magics.
------------------------------
&lt;rpy2.ipython.rmagic.Options object at 0x7ff95f080880&gt;
  - graphics device
      requested: svg
      found: grDevices::svg
        &lt;rpy2.ipython.rmagic.GraphicsDeviceSVG object at 0x7ff96165a230&gt;:
        grDevices::svg
        (extension: svg)
        Options and default values:

  - converter
    &lt;class &#39;rpy2.robjects.conversion.Converter&#39;&gt;
    py2rpy
    - builtins.object
    - rpy2.rinterface._MissingArgType
    - builtins.bool
    - builtins.int
    - builtins.float
    - builtins.bytes
    - builtins.str
    - rpy2.robjects.robject.RObject
    - rpy2.rinterface_lib.sexp.Sexp
    - array.array
    - builtins.list
    - rpy2.rlike.container.TaggedList
    - rpy2.rlike.container.NamedList
    - builtins.complex
    - builtins.function
    - numpy.ndarray
    - numpy.integer
    - numpy.floating
    - rpy2.rlike.container.OrdDict
    - pandas.core.frame.DataFrame
    - pandas.core.indexes.base.Index
    - pandas.core.arrays.categorical.Categorical
    - pandas.core.series.Series
    ---
    rpy2py
    - builtins.object
    - rpy2.robjects.robject.RObject
    - rpy2.rinterface.IntSexpVector
      - factor (in rpy2.robjects.pandas2ri)
    - rpy2.rinterface.FloatSexpVector
      - Date (in rpy2.robjects.vectors)
      - POSIXct (in rpy2.robjects.vectors)
    - rpy2.rinterface.ComplexSexpVector
    - rpy2.rinterface.BoolSexpVector
    - rpy2.rinterface_lib.sexp.StrSexpVector
    - rpy2.rinterface.ByteSexpVector
    - rpy2.rinterface.PairlistSexpVector
    - rpy2.rinterface.LangSexpVector
    - rpy2.rinterface.SexpClosure
    - rpy2.rinterface_lib.sexp.SexpEnvironment
    - rpy2.rinterface.ListSexpVector
      - data.frame (in rpy2.robjects.pandas2ri)
    - rpy2.rinterface.SexpS4
    - rpy2.rinterface.SexpExtPtr
    - rpy2.rinterface_lib.sexp.NULLType
    - rpy2.rinterface_lib.sexp.CharSexp
    - rpy2.rinterface_lib.sexp.Sexp
    - rpy2.rinterface_lib.sexp.SexpVector
    - rpy2.robjects.vectors.POSIXct
    - rpy2.robjects.vectors.DataFrame
    ---
</pre></div>
</div>
<section id="options-for-graphics-device">
<h4>Options for graphics device<a class="headerlink" href="#options-for-graphics-device" title="Link to this heading">¶</a></h4>
<p>Graphics devices, selected from a generic names when the case (see
above), may havee options. These options can be specific to each
graphics device.</p>
<p><strong>note: this is prefixed with an underscore to indicate that the API is
subject to changes.</strong></p>
<p>Options to display graphics are under <code class="docutils literal notranslate"><span class="pre">_options_display</span></code>. For example,
to change the default width:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="n">ipy</span><span class="o">.</span><span class="n">magics_manager</span><span class="o">.</span><span class="n">registry</span><span class="p">[</span><span class="s1">&#39;RMagics&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">graphics_device</span>
    <span class="o">.</span><span class="n">_options_display</span>
    <span class="o">.</span><span class="n">width</span>
<span class="p">)</span> <span class="o">=</span> <span class="mi">10</span>
</pre></div>
</div>
</section>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Using rpy2 in notebooks</a><ul>
<li><a class="reference internal" href="#data-import">Data Import</a></li>
<li><a class="reference internal" href="#graphics">Graphics</a><ul>
<li><a class="reference internal" href="#using-ggplot2">Using <code class="docutils literal notranslate"><span class="pre">ggplot2</span></code></a></li>
<li><a class="reference internal" href="#using-ggplot2-extensions">Using <code class="docutils literal notranslate"><span class="pre">ggplot2</span></code> extensions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#r-magics">R “magics”</a><ul>
<li><a class="reference internal" href="#options">Options.</a></li>
<li><a class="reference internal" href="#graphics-devices">Graphics devices</a><ul>
<li><a class="reference internal" href="#options-for-graphics-device">Options for graphics device</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="../introduction.html"
                          title="previous chapter">Introduction to rpy2</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="pandas.html"
                          title="next chapter"><code class="docutils literal notranslate"><span class="pre">R</span></code> and <code class="docutils literal notranslate"><span class="pre">pandas</span></code> data frames</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/generated_rst/notebooks.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="pandas.html" title="R and pandas data frames"
             >next</a> |</li>
        <li class="right" >
          <a href="../introduction.html" title="Introduction to rpy2"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">rpy2 3.6.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../getting-started.html" >Getting started</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Using rpy2 in notebooks</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2008-2022, Laurent Gautier &amp; rpy2 contributors.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    </div>
  </body>
</html>